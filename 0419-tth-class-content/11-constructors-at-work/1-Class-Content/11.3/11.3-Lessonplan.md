## 11.3 Lesson Plan: - After The Beep: Dealing With Callback Functions

### Overview
In this class we will be familiarizing students with callback functions and attempting to desmystify this difficult subject.

##### Instructor Priorities:

* Students should be able to articulate a general definition of callback functions.
* Students should be able to recognize callback functions.
* Students should be able to write functions that accept another function or functions as parameters. 
* Students should be able to write asynchronous callback functions, and be familiar with passing them in as arguments both by name or inline, i.e., as anonymous functions. 
* Students should be able to articulate the synchronous/asynchronous distinction.

##### Instructor Notes:

* In today's class, we are going to attack the callback function from all directions. Use analogies to real life examples and remind students that they've actually already used callbacks once before with `jQuery.get()`. Do whatever it takes to remove the mysteries surrounding this infamous topic!

-------

### Class Objectives

* To formally introduce the concept of the callback function.
* To demonstrate the most common uses of callback functions in JavaScript.
* To demystify callback functions and give students familiarity with their syntax.

-------

### 0. Instructor Do: Welcome Students (1 min)

* Welcome students to class and warn them that today's material can seem rather daunting in comparisson to the two previous lessons since today we will be tackling callback functions.

### 1. Instructor Do: Intro (20 mins)

* Explain to students the importance of callback functions and their role in giving JavaScript its asynchronous abilities. You can utilize the following example as a guide for this.

```
Let's say that we are an aspiring chef and we're following a recipe to cook chicken parmesean with a side-salad.

1) Set out a bowl of flour, a bowl of breadcrumbs, and some beaten eggs. 
2) Flour the chicken. 
3) Dip the chicken in your batter.
4) Hit that chicken with some breadcrumbs.
5) Throw the chicken in a preheated oven and set a timer to 20 minutes.
6) Take the chicken out of the oven. 
7) Pour marinara sauce over the chicken.
8) Sprinkle mozzarella on top.

The first five steps are fairly simple. They take us through the process of making chicken parmesean one step at a time in a linear fashion. Step number five, however, has us setting a timer for twenty minutes and then, if we were following the recipe word-for-word, removing the chicken from the oven immediately afterwards before it ever had the chance to finish cooking. That's certainly not what we want to happen since no one wants to eat raw chicken. As such, we should specify in our recipe that steps 6, 7, and 8 should only occur when the timer has gone off.

1) Set out a bowl of flour, a bowl of breadcrumbs, and some beaten eggs. 
2) Flour the chicken. 
3) Dip the chicken in your batter.
4) Hit that chicken with some breadcrumbs.
5) Throw the chicken in a preheated oven and set a timer to 20 minutes.*

*WHEN the timer has gone off...
5.1) Take the chicken out of the oven. 
5.2) Pour marinara sauce over the chicken.
5.3) Sprinkle mozzarella on top.

By doing this, step 5 must reach its completion before any future steps can be taken with our chicken. This is a great example of having a callback within code since one function (the finishing touches on our meal) require a previous function (the preparation of the chicken) to reach completion beforehand.

Since we don't want to just wait around for 20 minutes doing nothing, however, we can jump tracks to our second recipe and work on that side-salad whilst waiting for our original five steps to reach completion. As such, we are no longer working synchronously on one recipe, but instead working asynchronously on two recipes at once (working on one during the downtime of another).
```

* Emphasize that your students have already had some experience with callbacks before in the form of API calls and in setting up event listeners using jQuery.

* To reassure students that this isn't something entirely new for them, refer to the somewhat familiar piece of jQuery code below...

```js
$(‘#colorChangeButton’).on(‘click’, function (e) {
    $(‘body’).css({background: ‘black’});
});
```

* Point out to your students how this code has two distinct parts: An onClick event associated with pressing the `#colorChangeButton` and an inline function which specifies what we would like to happen when that button is pressed (turn the page's background black).

    * The inline function within this example is being passed into the onClick code as a parameter. This means that our inline function will only be called when `#colorChangeButton` is pressed, thus linking an event to a specified action.

    * Functions passed as parameters for other functions are called "callbacks"

### 2. Students Do: Searching for Callbacks (5 mins)

* Have students Google around to find a concise definition of callback functions along with a couple examples of their usage.

* Call on students to offer the definitions and uses that they have discovered.

### 3. Students Do: Total and Tax (10 mins)

* Announce to the class that this is a preliminary exercise to the introduction of callback functions.

* Slack out the following instructions.

* **Instructions**

    * Create two variables. Both variables should be numbers representing the cost of an item for sale (e.g. 4.99)

    * Define a function that takes in two parameters — the two variables you've created will be the arguments — and returns their sum.

    * Define another function that takes in one parameter — a number — and returns that value increased by 10%.

    * Pass the variables you created to the first function and then pass the resulting sum through the second function. Console log the result.

        * If you use 4.99 and 11.49 as the initial values, then you should get 17.96 as a result.

### 4. Everyone Do: Going Over Total and Tax (15 mins)

* Review the previous activity, making sure to hit upon all of the different parts contained within [TotalAndTax-NoCallback.js](Activities/1-TotalAndTax/TotalAndTax-NoCallback.js)

* Once you have gone over the basic assignment, announce to the class that you're going to tweak the code to use a callback function by replacing lines 17 to 21 with the following code...

```js
var total = addTheTax(addThemUp(videoGame,Movie));
```

* Walk your students through the minor changes included within [TotalAndTax-Callback.js](Activities/1-TotalAndTax/TotalAndTax-Callback.js) before asking them to describe to you how this code is different from the solution to the previous activity.

    * The new code provides the `addTheTax` function with the `addThemUp` function as its sole parameter instead of providing it with sum.

    * This essentially tells the `addTheTax` function to run the `addThemUp` function and grab its result before running itself.

    * Run the code within your terminal to show how the changes affected the code.

* We can even create applications/functions which contain multiple callbacks within the same line. Open up [TotalAndTax-NestedCallback.js](Activities/1-TotalAndTax/TotalAndTax-NestedCallback.js) within sublime and run them through this new application before running the code within your terminal.

* While callbacks included within applications as simple as those above do not seem all that helpful overall, they can be an exceptionally helpful tool in creating applications which include asynchronous elements. This is because they ensure that specific functions run through until completion before starting up any code which may require the data created, modified, and/or stored within those functions. In other words, callbacks can force synchronous behavior upon otherwise asynchronous code.

    * When you start placing functions within one-another like we did in the previous example, each new function is added onto something called "The Stack"

    * "The Stack" is a fairly simple concept to understand when placed into the context of something like pancakes. When you order a large stack of pancakes at a restaurant, you are going to want to eat from the top of the stack before working your way down towards the bottom. In essence, you are removing each pancake from the stack individually in order to reach the plate.

    * In other words, each new function added onto the stack is run before moving onto the function beneath it. Once data has been returned from the function above, the function below will start.

### 6. Instructor Do: "Asynchronous JavaScript" (15 mins)

* Reinforce the idea of "asynchronous JavaScript" by bringing the students' attention to the difference between the usage of callback functions in the items directly above and the usage of callback functions in something like API calls and event-listeners.

* Open up [APICall.js](Activities/2-AsynchExamples/APICall.js) within Sublime and ask the class what they think will happen when we run this code in the terminal.

    * Before running this code, make sure to `npm install request`

    * Point out to your class how the first thing printed to the screen is actually a line of code further down on the page. Not only that, but it is returning "undefined" rather than the name of a color.

    * The reason for this is because it takes time for the browser to call upon the API and return a response. Because of that, however, the console assumes that we would like to continue running our code and thus skips down to the next line available.

    * In this way, our code is running both linearly (line-by-line) and asynchronously by skipping over code whilst it awaits a response.

* While JavaScript is indeed single-threaded and runs through code linearly, it's not the only player in the game. The browser itself runs alongside your code and, as such, if there is code which requires the collection of data from the browser itself, JavaScript will not necessarily wait for a response unless otherwise instructed to.

* Open up [APICallback.js](Activities/2-AsynchExamples/APICallback.js) within Sublime and ask the class what has changed between this code and the last.

    * While we did include a callback in the original request, this one also contains the console.log() for printing the variable "color" to the screen. This essentially tells the console to wait until a response is given BEFORE logging anything.

### 7. Instructor Do: Callbacks - What Are They Good For? (10 mins)

* There are a couple great reasons to use callbacks within your code. For example...

    * They prevent you from having to repeat the same lines of code multiple times by instead turning one piece of code into a callback which can be reused.

    * They allow for better abstraction where you can have more generic functions that are extremely versatile (can handle all sorts of functionalities)

    * Are easier to maintain since you would only need to change one piece of code rather than having to change the same piece of code multiple times.

    * Make your code more readable.

    * Allow for more specialized functions.

* To exemplify how helpful callbacks can be, open up [APISuperCallback.js](Activities/2-AsynchExamples/APISuperCallback.js) within Sublime and go through the code line-by-line as you explain to your students how, by adding the callback of `printColor` into `getRandomColor` and `getSpecificColor`, we are able to reuse the same code multiple times for different functions.

    * Make sure your students understand the syntax for callbacks that is being used here. It is slightly different than the syntax we used earlier since we are not returning any data to the function that is calling upon the callback.

    * Instead of passing data into a function, we are passing a function into another function to be run.

### 8. Students Do: Mad-Libs (50 mins)

* Answer whatever questions your students may have before slacking out the following instructions...

* **Instructions**

    * Using inquirer, constructors, and callbacks, you are going to create a mad libs application which takes in user input and creates a story with those words entered.

    * Your constructor should be able to create objects with four properties...
        * An empty array of adjectives
        * An empty array of nouns
        * An empty array of verbs
        * An array or string which will contain all of the individual pieces of your story

    * Your inquirer prompts should be contained within a recursive function with a callback parameter which we will use to print out our final story

    * HINT: Keep in mind how you will select/replace specific elements when laying out the framework for your story and the callback function you will be using to create/print the final product.

    * HINT: Start out with a small and simple story before moving onto more complex tales.

-------

### BREAK TIME (40 mins)

-------

### 9. Everyone Do: Mad-Libs Review (20 mins)

* Before going into the provided example for the "Mad-Libs" activity, see if there are any brave souls within the class who would be willing to share their code, run through it, and then explain how it functions to the class.

    * Feel free to do this a couple times if there are multiple students within the class who are willing to share their code. This should especially be the case if their code is slightly different than the last student's code.

* Open up [MadLibs.js](Activities/3-MadLibs/MadLibs.js) within Sublime and run through the code line-by-line with your students to make sure they understand all of the topics being covered.

### 10. Partners Do: Create Something Cool (50 mins)

* Answer whatever questions your class might have before slacking out the following instructions...

* **Instructions**

    * You now have at your disposal a wide variety of tools which you could use in order to create something rather impressive using Node.js. Your task for the next 40 minutes or so is to work alongside with another student to create a prototype for an application which includes the following...

        * Constructors

        * User input

        * Callback functions

    * BEWARE THE DREADED SCOPE CREEP! You and your partner only have a limited amount of time to create an application, so start out with something simplistic and then work your way up from there once the initial application is functioning properly.

    * HINT: Remember, you have a whole bunch NPM packages just sitting out there waiting to be used. If you think there is some prewritten code out there which you can use, check online to see if you can save yourself some time.

    * HINT: After time has run up, we will be asking random groups to come up and share their applications with the class. So, once again, BEWARE THE DREADED SCOPE CREEP!

### 12. Everyone Do: Showing Off (15 mins)

* Call upon random groups to share their applications with the class. Choose groups which you feel have managed to create something so as to avoid embarassing anyone.

* Have the groups you call up run through and explain their code to the class to the best of their ability. Don't let them take up too much time, however, since we want as many groups as possible to share their prototypes with the class.

# Copyright
Coding Boot Camp (C) 2016. All Rights Reserved.